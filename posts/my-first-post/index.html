<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=content-language content="zh-cn">
<meta name=color-scheme content="light dark">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/monokai.min.css>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script>
<meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self' https://s1.ax1x.com; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;">
<meta name=author content="语冰">
<meta name=description content="PySpark Read And Write JSON file ">
<meta name=keywords content="安全研究员,软件工程师,数据分析爱好者">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Pyspark读取和保存Json文件">
<meta name=twitter:description content="PySpark Read And Write JSON file ">
<meta property="og:title" content="Pyspark读取和保存Json文件">
<meta property="og:description" content="PySpark Read And Write JSON file ">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.yubing.co/posts/my-first-post/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-11-11T11:00:45+08:00">
<meta property="article:modified_time" content="2021-11-11T11:00:45+08:00"><meta property="og:site_name" content="语冰">
<title>
Pyspark读取和保存Json文件 · 语冰
</title>
<link rel=canonical href=https://www.yubing.co/posts/my-first-post/>
<link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin>
<link rel=stylesheet href=/css/coder.min.9800fae273b590afec9dc5ff15104d0c8dbee34abc5f4caa8dc9bab00745b78e.css integrity="sha256-mAD64nO1kK/sncX/FRBNDI2+40q8X0yqjcm6sAdFt44=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=/css/coder-dark.min.876b132a2ef3947e5bdc3c8dbeda49fc71bd5a4abbd4ddfbc92e8112aebfebe3.css integrity="sha256-h2sTKi7zlH5b3DyNvtpJ/HG9Wkq71N37yS6BEq6/6+M=" crossorigin=anonymous media=screen>
<link rel=icon type=image/png href=/images/favicon.png sizes=32x32>
<link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16>
<link rel=apple-touch-icon href=/images/apple-touch-icon.png>
<link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png>
<meta name=generator content="Hugo 0.91.2">
</head>
<body class="preload-transitions colorscheme-dark">
<div class=float-container>
<a id=dark-mode-toggle class=colorscheme-toggle>
<i class="fa fa-adjust fa-fw" aria-hidden=true></i>
</a>
</div>
<main class=wrapper>
<nav class=navigation>
<section class=container>
<a class=navigation-title href=/>
语冰
</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle>
<i class="fa fa-bars fa-fw" aria-hidden=true></i>
</label>
<ul class=navigation-list>
<li class=navigation-item>
<a class=navigation-link href=/about/>关于</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/posts/>文章</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/projects/>项目</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/contact/>联系我</a>
</li>
<li class="navigation-item menu-separator">
<span>|</span>
</li>
<li class=navigation-item>
<a href=https://www.yubing.co/en/>🇬🇧</a>
</li>
</ul>
</section>
</nav>
<div class=content>
<section class="container post">
<article>
<header>
<div class=post-title>
<h1 class=title>
<a class=title-link href=https://www.yubing.co/posts/my-first-post/>
Pyspark读取和保存Json文件
</a>
</h1>
</div>
<div class=post-meta>
<div class=date>
<span class=posted-on>
<i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2021-11-11T11:00:45+08:00>
November 11, 2021
</time>
</span>
<span class=reading-time>
<i class="fa fa-clock-o" aria-hidden=true></i>
阅读时间：1 分钟
</span>
</div>
<div class=authors>
<i class="fa fa-user" aria-hidden=true></i>
<a href=/authors/he110w0r1d/>he110w0r1d</a></div>
<div class=categories>
<i class="fa fa-folder" aria-hidden=true></i>
<a href=/categories/big-data/>big data</a>
<span class=separator>•</span>
<a href=/categories/spark/>spark</a></div>
<div class=tags>
<i class="fa fa-tag" aria-hidden=true></i>
<span class=tag>
<a href=/tags/pyspark/>pyspark</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/tags/json/>json</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/tags/io/>io</a>
</span></div>
</div>
</header>
<div>
<h2 id=目录>
目录
<a class=heading-link href=#%e7%9b%ae%e5%bd%95>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<ul>
<li><a href=#%E5%B0%86JSON%E6%96%87%E4%BB%B6%E8%AF%BB%E5%85%A5DataFrame>将JSON文件读入DataFrame</a>
<ul>
<li><a href=#%E8%AF%BB%E5%8F%96%E5%8C%85%E5%90%AB%E5%A4%9A%E8%A1%8Cjson%E7%9A%84%E5%8D%95%E4%B8%AAJson%E6%96%87%E4%BB%B6>读取包含多个单行json的单个Json文件</a></li>
<li><a href=#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84schema%E8%AF%BB%E5%8F%96json%E6%96%87%E4%BB%B6>使用自定义的schema读取json文件</a></li>
<li><a href=#%E8%AF%BB%E5%8F%96%E5%8C%85%E5%90%AB%E5%A4%9A%E8%A1%8Cjson%E5%88%97%E8%A1%A8%E7%9A%84%E5%8D%95%E4%B8%AAjson%E6%96%87%E4%BB%B6>读取包含多行json列表的单个json文件</a></li>
<li><a href=#%E4%B8%80%E6%AC%A1%E8%AF%BB%E5%8F%96%E5%A4%9A%E4%B8%AAjson%E6%96%87%E4%BB%B6>一次读取多个json文件</a></li>
<li><a href=#%E8%AF%BB%E5%8F%96%E6%8C%87%E5%AE%9A%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89json%E6%96%87%E4%BB%B6>读取指定目录下的所有json文件</a></li>
<li><a href=#%E9%80%92%E5%BD%92%E8%AF%BB%E5%8F%96%E6%8C%87%E5%AE%9A%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%89%80%E6%9C%89%E7%9A%84json%E6%96%87%E4%BB%B6>递归读取指定目录下所有的json文件</a></li>
</ul>
</li>
<li><a href=#%E5%B0%86dataframe%E4%BF%9D%E5%AD%98%E4%B8%BAjson%E6%96%87%E4%BB%B6>将dataframe保存为json文件</a>
<ul>
<li><a href=#%E4%BF%9D%E5%AD%98%E6%A8%A1%E5%BC%8F>保存模式</a></li>
<li><a href=#%E4%BF%9D%E5%AD%98%E9%80%89%E9%A1%B9>保存选项</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id=将json文件读入dataframe>
将JSON文件读入DataFrame
<a class=heading-link href=#%e5%b0%86json%e6%96%87%e4%bb%b6%e8%af%bb%e5%85%a5dataframe>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<h3 id=读取包含多行json的单个json文件>
读取包含多行json的单个Json文件
<a class=heading-link href=#%e8%af%bb%e5%8f%96%e5%8c%85%e5%90%ab%e5%a4%9a%e8%a1%8cjson%e7%9a%84%e5%8d%95%e4%b8%aajson%e6%96%87%e4%bb%b6>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<p>forexample.json文件:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=font-weight:700>&#34;id&#34;</span>: 0, <span style=font-weight:700>&#34;name&#34;</span>: <span style=font-style:italic>&#34;bob&#34;</span>, <span style=font-weight:700>&#34;time&#34;</span>: <span style=font-style:italic>&#34;2021-07-23 08:10:59&#34;</span>}
{<span style=font-weight:700>&#34;id&#34;</span>: 1, <span style=font-weight:700>&#34;name&#34;</span>: <span style=font-style:italic>&#34;alice&#34;</span>, <span style=font-weight:700>&#34;time&#34;</span>: <span style=font-style:italic>&#34;2021-07-21 02:10:00&#34;</span>}
{<span style=font-weight:700>&#34;id&#34;</span>: 2, <span style=font-weight:700>&#34;name&#34;</span>: <span style=font-style:italic>&#34;jack&#34;</span>, <span style=font-weight:700>&#34;time&#34;</span>: <span style=font-style:italic>&#34;2021-07-24 08:15:51&#34;</span>}
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>df = spark.read.json(<span style=font-style:italic>&#34;forexample.json&#34;</span>)
df.printSchema()
df.show()
</code></pre></div><p>输出：</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>root
 |-- id: long (nullable = true)
 |-- name: string (nullable = true)
 |-- time: string (nullable = true)

+---+-----+-------------------+
| id| name|               time|
+---+-----+-------------------+
|  0|  bob|2021-07-23 08:10:59|
|  1|alice|2021-07-21 02:10:00|
|  2| jack|2021-07-24 08:15:51|
+---+-----+-------------------+
</code></pre></div><h3 id=使用自定义的schema读取json文件>
使用自定义的schema读取json文件
<a class=heading-link href=#%e4%bd%bf%e7%94%a8%e8%87%aa%e5%ae%9a%e4%b9%89%e7%9a%84schema%e8%af%bb%e5%8f%96json%e6%96%87%e4%bb%b6>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<p>读取json文件时，不支持数据类型推断，可在读取时指定数据类型。</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>schema = StructType([
      StructField(<span style=font-style:italic>&#34;id&#34;</span>,IntegerType(),<span style=font-weight:700>True</span>),
      StructField(<span style=font-style:italic>&#34;name&#34;</span>,StringType(),<span style=font-weight:700>True</span>),
      StructField(<span style=font-style:italic>&#34;time&#34;</span>,TimestampType(),<span style=font-weight:700>True</span>)
  ])

df_with_schema = spark.read.schema(schema) \
        .json(<span style=font-style:italic>&#34;./forexample.json&#34;</span>)
df_with_schema.printSchema()
df_with_schema.show()
</code></pre></div><p><a href=https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql.html#data-types>查看更多数据类型</a></p>
<h3 id=读取包含多行json列表的单个json文件>
读取包含多行json列表的单个Json文件
<a class=heading-link href=#%e8%af%bb%e5%8f%96%e5%8c%85%e5%90%ab%e5%a4%9a%e8%a1%8cjson%e5%88%97%e8%a1%a8%e7%9a%84%e5%8d%95%e4%b8%aajson%e6%96%87%e4%bb%b6>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<p>multiline-forexample.json文件:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>[{
    <span style=font-weight:700>&#34;id&#34;</span>: 0, 
    <span style=font-weight:700>&#34;name&#34;</span>: <span style=font-style:italic>&#34;bob&#34;</span>,
    <span style=font-weight:700>&#34;time&#34;</span>: <span style=font-style:italic>&#34;2021-07-23 08:10:59&#34;</span>
 },
{
    <span style=font-weight:700>&#34;id&#34;</span>: 1,
    <span style=font-weight:700>&#34;name&#34;</span>: <span style=font-style:italic>&#34;alice&#34;</span>, 
    <span style=font-weight:700>&#34;time&#34;</span>: <span style=font-style:italic>&#34;2021-07-21 02:10:00&#34;</span>
},
{
    <span style=font-weight:700>&#34;id&#34;</span>: 2, 
    <span style=font-weight:700>&#34;name&#34;</span>: <span style=font-style:italic>&#34;jack&#34;</span>,
    <span style=font-weight:700>&#34;time&#34;</span>: <span style=font-style:italic>&#34;2021-07-24 08:15:51&#34;</span>
}]
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>multiline_df = spark.read.option(<span style=font-style:italic>&#34;multiline&#34;</span>,<span style=font-style:italic>&#34;true&#34;</span>) \
      .json(<span style=font-style:italic>&#34;multiline-forexample.json&#34;</span>)
multiline_df.show()    
</code></pre></div><h3 id=一次读取多个json文件>
一次读取多个json文件
<a class=heading-link href=#%e4%b8%80%e6%ac%a1%e8%af%bb%e5%8f%96%e5%a4%9a%e4%b8%aajson%e6%96%87%e4%bb%b6>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>df2 = spark.read.json(jsonFilePathList)
df2.show()  
</code></pre></div><h3 id=读取指定目录下的所有json文件>
读取指定目录下的所有json文件
<a class=heading-link href=#%e8%af%bb%e5%8f%96%e6%8c%87%e5%ae%9a%e7%9b%ae%e5%bd%95%e4%b8%8b%e7%9a%84%e6%89%80%e6%9c%89json%e6%96%87%e4%bb%b6>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>df3 = spark.read.json(<span style=font-style:italic>&#34;path/*.json&#34;</span>)
df3.show()
</code></pre></div><h3 id=递归读取指定目录下所有的json文件>
递归读取指定目录下所有的json文件
<a class=heading-link href=#%e9%80%92%e5%bd%92%e8%af%bb%e5%8f%96%e6%8c%87%e5%ae%9a%e7%9b%ae%e5%bd%95%e4%b8%8b%e6%89%80%e6%9c%89%e7%9a%84json%e6%96%87%e4%bb%b6>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<div class="notice tip">
<div class=notice-title>
<i class="fa fa-lightbulb-o" aria-hidden=true></i>提示
</div>
<div class=notice-content>Spark 3.0下支持</div>
</div>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>recursive_loaded_df = spark.read\
    .option(<span style=font-style:italic>&#34;recursiveFileLookup&#34;</span>, <span style=font-style:italic>&#34;true&#34;</span>)\
    .json(path)

recursive_loaded_df.show()    
</code></pre></div><p>或者</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>recursive_loaded_df = spark.read.format(<span style=font-style:italic>&#34;json&#34;</span>)\
    .option(<span style=font-style:italic>&#34;recursiveFileLookup&#34;</span>, <span style=font-style:italic>&#34;true&#34;</span>)\
    .load(path)
recursive_loaded_df.show()
</code></pre></div><hr>
<h2 id=将dataframe保存为json文件>
将dataframe保存为json文件
<a class=heading-link href=#%e5%b0%86dataframe%e4%bf%9d%e5%ad%98%e4%b8%bajson%e6%96%87%e4%bb%b6>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>df.write.mode(&#39;Overwrite&#39;).json(&#34;./zipcodes.json&#34;)
</code></pre></div><h3 id=保存模式>
保存模式
<a class=heading-link href=#%e4%bf%9d%e5%ad%98%e6%a8%a1%e5%bc%8f>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<p>overwrite – 覆盖：覆盖已存在的文件</p>
<p>append – 附加：将数据附加到已存在文件</p>
<p>ignore – 忽略：当文件已经存在时，忽略写操作</p>
<p>errorifexists or error – 抛出错误：默认选项，文件已经存在时，返回错误。</p>
<h3 id=保存选项>
保存选项
<a class=heading-link href=#%e4%bf%9d%e5%ad%98%e9%80%89%e9%a1%b9>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<p>timeZone、dateFormat、timestampFormat、encoding、lineSep、compression等</p>
<p>举个栗子：</p>
<p>将数据保存json文件时，格式化时间戳</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>df_with_schema.write.mode(<span style=font-style:italic>&#39;Overwrite&#39;</span>)\
    .option(<span style=font-style:italic>&#34;timestampFormat&#34;</span>, <span style=font-style:italic>&#34;yyyy-MM-dd HH:mm:ss&#34;</span>)\
    .json(<span style=font-style:italic>&#34;./timestampFormat.json&#34;</span>)
</code></pre></div><p>timestampFormat.json</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>{&#34;id&#34;:0,&#34;name&#34;:&#34;bob&#34;,&#34;time&#34;:&#34;2021-07-23 08:10:59&#34;}
</code></pre></div><h2 id=参考>
参考
<a class=heading-link href=#%e5%8f%82%e8%80%83>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<ol>
<li><a href=https://sparkbyexamples.com/pyspark/pyspark-read-json-file-into-dataframe/>https://sparkbyexamples.com/pyspark/pyspark-read-json-file-into-dataframe/</a></li>
<li><a href=https://spark.apache.org/docs/latest/sql-data-sources-generic-options.html/>https://spark.apache.org/docs/latest/sql-data-sources-generic-options.html/</a></li>
</ol>
</div>
<footer>
</footer>
</article>
</section>
</div>
<footer class=footer>
<section class=container>
<p>脚踏实地，仰望星空</p>
©
2019 -
2022
语冰
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.
</section>
</footer>
</main>
<script src=/js/coder.min.03b17769f4f91ae35667e1f2a1ca8c16f50562576cf90ff32b3179926914daa5.js integrity="sha256-A7F3afT5GuNWZ+HyocqMFvUFYlds+Q/zKzF5kmkU2qU="></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HLNV7SWJXG"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-HLNV7SWJXG')</script>
</body>
</html>